<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kotlin null safety and its performance considerations -- part 1</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link rel='stylesheet' href='./styles.css'>
  <link href='https://fonts.googleapis.com/css?family=Anonymous+Pro:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600' rel='stylesheet' type='text/css'>
</head>
<body>
<div id="layout" class="layout">
  <header class="article-nav">
    <button class="menu-link">
      <!-- Hamburger icon -->
      <span></span>
    </button>
    <div class="article-nav-links">
      <a href="Ad-hoc-polymorphism-in-Kotlin.html" class="article-nav-link article-nav-link--prev">previous</a>
      <a href="Kotlin-Native.html" class="article-nav-link article-nav-link--next">next</a>
    </div>
  </header>

  <aside id="menu" class="menu">
    <div class="pure-menu">
      <ul class="pure-menu-list">
        <li class="pure-menu-list-date">Aug 04, 2016</li><li><a href="./Calling-on-EAPers.html">Calling on EAPers</a></li>
<li class="pure-menu-list-date">Aug 03, 2016</li><li><a href="./Andrey-Breslav-Kotlin-Coroutines-JVMLS-2016.html">Andrey Breslav: Kotlin Coroutines, JVMLS 2016</a></li>
<li class="pure-menu-list-date">Jul 14, 2016</li><li><a href="./First-glimpse-of-Kotlin-1-1-Coroutines-Type-aliases-and-more.html">First glimpse of Kotlin 1.1: Coroutines, Type aliases and more</a></li>
<li class="pure-menu-list-date">Jul 06, 2016</li><li><a href="./Never-say-final-mocking-Kotlin-classes-in-unit-tests.html">Never say final: mocking Kotlin classes in unit tests</a></li>
<li class="pure-menu-list-date">Jun 30, 2016</li><li><a href="./Kotlin-1-0-3-Is-Here.html">Kotlin 1.0.3 Is Here!</a></li>
<li class="pure-menu-list-date">Jun 25, 2016</li><li><a href="./How-to-get-IDEA-to-detect-kotlin-generated-sources-using-Gradle.html">How to get IDEA to detect kotlin generated sources using Gradle</a></li>
<li class="pure-menu-list-date">Jun 20, 2016</li><li><a href="./Ad-hoc-polymorphism-in-Kotlin.html">Ad-hoc polymorphism in Kotlin</a></li>
<li><a href="./Kotlin-null-safety-and-its-performance-considerations-part-1.html">Kotlin null safety and its performance considerations -- part 1</a></li>
<li class="pure-menu-list-date">Jun 17, 2016</li><li><a href="./Kotlin-Native.html">Kotlin Native</a></li>
<li class="pure-menu-list-date">Jun 14, 2016</li><li><a href="./Kotlin-Night-in-San-Francisco-Recordings.html">Kotlin Night in San Francisco Recordings</a></li>
<li><a href="./News-from-KotlinTest.html">News from KotlinTest</a></li>
<li class="pure-menu-list-date">Jun 13, 2016</li><li><a href="./Meet-the-Kotlin-Team-at-Gradle-Summit.html">Meet the Kotlin Team at Gradle Summit</a></li>
<li class="pure-menu-list-date">Jun 09, 2016</li><li><a href="./Архитектор-Kotlin-Язык-программирования-—-рабочий-инструмент-Если-никогда-их-не-менять-можно-отстать-от-жизни-.html">Архитектор Kotlin: «Язык программирования — рабочий инструмент. Если никогда их не менять, можно отстать от жизни» </a></li>
<li class="pure-menu-list-date">Jun 08, 2016</li><li><a href="./Kotlin-1-0-3-EAP.html">Kotlin 1.0.3 EAP</a></li>
<li class="pure-menu-list-date">Jun 06, 2016</li><li><a href="./When-Kotlin-met-Gradle.html">When Kotlin met Gradle</a></li>
<li class="pure-menu-list-date">Jun 03, 2016</li><li><a href="./Kotlin-Eclipse-Plugin-0-7-Is-Here.html">Kotlin Eclipse Plugin 0.7 Is Here!</a></li>
<li class="pure-menu-list-date">Jun 02, 2016</li><li><a href="./What’s-in-store-for-Kotlin-this-year.html">What’s in store for Kotlin this year</a></li>
<li class="pure-menu-list-date">Jun 01, 2016</li><li><a href="./Where-We-Stand-What-s-Next-for-Kotlin.html">Where We Stand & What's Next for Kotlin</a></li>
<li class="pure-menu-list-date">May 30, 2016</li><li><a href="./Neural-Networks-in-Kotlin-part-2.html">Neural Networks in Kotlin (part 2)</a></li>
<li class="pure-menu-list-date">May 27, 2016</li><li><a href="./Neural-Network-in-Kotlin.html">Neural Network in Kotlin</a></li>
<li class="pure-menu-list-date">May 20, 2016</li><li><a href="./Kotlin-dragging-java-into-the-modern-world.html">Kotlin, dragging java into the modern world</a></li>
<li class="pure-menu-list-date">May 18, 2016</li><li><a href="./Gradle-Meets-Kotlin.html">Gradle Meets Kotlin</a></li>
<li><a href="./Kotlin-Meets-Gradle.html">Kotlin Meets Gradle</a></li>
<li class="pure-menu-list-date">May 17, 2016</li><li><a href="./Gradle-Elevates-the-Build-to-First-Class-Programming-With-Kotlin-Language.html">Gradle Elevates the Build to First-Class Programming With Kotlin Language</a></li>
<li class="pure-menu-list-date">May 13, 2016</li><li><a href="./Kotlin-1-0-2-is-Here.html">Kotlin 1.0.2 is Here</a></li>
<li class="pure-menu-list-date">May 12, 2016</li><li><a href="./Kosent.html">Kosent</a></li>
<li class="pure-menu-list-date">May 10, 2016</li><li><a href="./Testing-in-Kotlin.html">Testing in Kotlin</a></li>
<li class="pure-menu-list-date">May 01, 2016</li><li><a href="./JMock-and-Kotlin.html">JMock and Kotlin</a></li>
<li class="pure-menu-list-date">Apr 29, 2016</li><li><a href="./Exercises-in-Kotlin-Part-5-Classes.html">Exercises in Kotlin: Part 5 - Classes</a></li>
<li class="pure-menu-list-date">Apr 27, 2016</li><li><a href="./Exercises-in-Kotlin-Part-4-Control-flows-and-return.html">Exercises in Kotlin: Part 4 - Control flows and return</a></li>
<li class="pure-menu-list-date">Apr 24, 2016</li><li><a href="./Writing-Concise-Code-With-Kotlin.html">Writing Concise Code With Kotlin</a></li>
<li><a href="./Type-safe-JavaFX-CSS-with-TornadoFX.html">Type safe JavaFX CSS with TornadoFX</a></li>
<li class="pure-menu-list-date">Apr 21, 2016</li><li><a href="./JDK7-8-features-in-Kotlin-1-0.html">JDK7/8 features in Kotlin 1.0</a></li>
<li class="pure-menu-list-date">Apr 20, 2016</li><li><a href="./Kotlin-Android-First-Impressions.html">Kotlin + Android First Impressions</a></li>
<li><a href="./Exercises-in-Kotlin-Part-3-Functions.html">Exercises in Kotlin: Part 3 - Functions</a></li>
<li class="pure-menu-list-date">Apr 19, 2016</li><li><a href="./Exercises-in-Kotlin-Part-2-High-level-syntax-and-Variables.html">Exercises in Kotlin: Part 2 - High level syntax and Variables</a></li>
<li class="pure-menu-list-date">Apr 18, 2016</li><li><a href="./Exercises-in-Kotlin-Part-1-Getting-Started.html">Exercises in Kotlin: Part 1 - Getting Started</a></li>
<li class="pure-menu-list-date">Apr 17, 2016</li><li><a href="./Code-improvements-with-Kotlin.html">Code improvements with Kotlin</a></li>
<li class="pure-menu-list-date">Apr 15, 2016</li><li><a href="./Few-thoughts-about-Kotlin-and-why-I-like-it-so-much.html">Few thoughts about Kotlin and why I like it so much</a></li>
<li class="pure-menu-list-date">Apr 14, 2016</li><li><a href="./Kotlin-for-Scala-Developers.html">Kotlin for Scala Developers</a></li>
<li><a href="./Kotlin-Post-1-0-Roadmap.html">Kotlin Post-1.0 Roadmap</a></li>
<li class="pure-menu-list-date">Apr 11, 2016</li><li><a href="./Making-Android-Development-Easier.html">Making Android Development Easier</a></li>
<li class="pure-menu-list-date">Apr 09, 2016</li><li><a href="./Keddit — Part-7-Infinite-Scroll-Higher-Order-functions-Lambdas.html">Keddit — Part 7: Infinite Scroll: Higher-Order functions & Lambdas</a></li>
<li><a href="./The-Kobalt-diaries-Automatic-Android-SDK-management.html">The Kobalt diaries: Automatic Android SDK management</a></li>
<li class="pure-menu-list-date">Apr 07, 2016</li><li><a href="./Android-And-Kotlin.html">Android And Kotlin</a></li>
<li class="pure-menu-list-date">Apr 06, 2016</li><li><a href="./Kotlin-Digest-2016-Q1.html">Kotlin Digest 2016.Q1</a></li>
<li><a href="./Kotlin-DSL-Anko.html">Kotlin DSL: Anko</a></li>
<li class="pure-menu-list-date">Apr 04, 2016</li><li><a href="./Kotlin-Practical-Experience.html">Kotlin: Practical Experience</a></li>
<li><a href="./Kotlin’s-killer-features.html">Kotlin’s killer features</a></li>
<li><a href="./Exploring-Delegation-in-Kotlin.html">Exploring Delegation in Kotlin</a></li>
<li class="pure-menu-list-date">Apr 03, 2016</li><li><a href="./Experimental-Kotlin-and-mutation-testing.html">Experimental: Kotlin and mutation testing</a></li>
<li class="pure-menu-list-date">Mar 31, 2016</li><li><a href="./10-Features-I-Wish-Java-Would-Steal-From-the-Kotlin-Language.html">10 Features I Wish Java Would Steal From the Kotlin Language</a></li>
<li class="pure-menu-list-date">Mar 30, 2016</li><li><a href="./Ubuntu-Make-16-03-Released-With-Eclipse-JEE-And-IntelliJ-IDEA-EAP-Support-More.html">Ubuntu Make 16.03 Released With Eclipse JEE And IntelliJ IDEA EAP Support, More</a></li>
<li><a href="./Kotlin’s-Android-Roadmap.html">Kotlin’s Android Roadmap</a></li>
<li class="pure-menu-list-date">Mar 29, 2016</li><li><a href="./Rest-API-plumbing-with-kotlin.html">Rest API plumbing with kotlin</a></li>
<li class="pure-menu-list-date">Mar 28, 2016</li><li><a href="./Creating-an-AndroidWear-watchface-using-Kotlin.html">Creating an AndroidWear watchface using Kotlin</a></li>
<li class="pure-menu-list-date">Mar 22, 2016</li><li><a href="./Writing-a-RESTful-backend-using-Kotlin-and-Spring-Boot.html">Writing a RESTful backend using Kotlin and Spring Boot</a></li>
<li><a href="./How-to-Hot-Deploy-Java-Kotlin-classes-in-Dev.html">How to Hot Deploy Java/Kotlin classes in Dev</a></li>
<li><a href="./RU-Андрей-Бреслав-и-Дмитрий-Жемеров-о-Kotlin-1-0-на-jug-msk-ru.html">(RU) Андрей Бреслав и Дмитрий Жемеров о Kotlin 1.0 на jug.msk.ru</a></li>
<li class="pure-menu-list-date">Mar 20, 2016</li><li><a href="./A-Geospatial-Messenger-with-Kotlin-Spring-Boot-and-PostgreSQL.html">A Geospatial Messenger with Kotlin, Spring Boot and PostgreSQL</a></li>
<li class="pure-menu-list-date">Mar 19, 2016</li><li><a href="./Algebraic-Data-Types-In-Kotlin.html">Algebraic Data Types In Kotlin</a></li>
<li><a href="./Kotlin-Month-Post-4-Properties.html">Kotlin Month Post 4: Properties</a></li>
<li class="pure-menu-list-date">Mar 17, 2016</li><li><a href="./Kotlin-Educational-Plugin.html">Kotlin Educational Plugin</a></li>
<li class="pure-menu-list-date">Mar 16, 2016</li><li><a href="./Using-Kotlin-For-Tests-in-Android.html">Using Kotlin For Tests in Android</a></li>
<li><a href="./Kotlin-1-0-1-is-Here.html">Kotlin 1.0.1 is Here!</a></li>
<li><a href="./Kotlin-recipes-for-Android-I-OnGlobalLayoutListener.html">Kotlin recipes for Android (I): OnGlobalLayoutListener</a></li>
<li class="pure-menu-list-date">Mar 15, 2016</li><li><a href="./Kotlin-Retrofit-RxAndroid-Realm.html">Kotlin : Retrofit + RxAndroid + Realm</a></li>
<li class="pure-menu-list-date">Mar 14, 2016</li><li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Wrap-Up.html">Kotlin & Android: A Brass Tacks Experiment Wrap-Up</a></li>
<li class="pure-menu-list-date">Mar 13, 2016</li><li><a href="./Kotlin-Month-Post-3-Safety.html">Kotlin Month Post 3: Safety</a></li>
<li><a href="./Feedback-on-the-Josephus-problem.html">Feedback on the Josephus problem</a></li>
<li class="pure-menu-list-date">Mar 11, 2016</li><li><a href="./RU-SDCast-41-в-гостях-Андрей-Бреслав-руководитель-проекта-Kotlin-в-компании-JetBrains.html">(RU) SDCast #41: в гостях Андрей Бреслав, руководитель проекта Kotlin в компании JetBrains</a></li>
<li><a href="./Why-I-don-t-want-to-use-Kotlin-for-Android-Development-yet.html">Why I don't want to use Kotlin for Android Development yet</a></li>
<li class="pure-menu-list-date">Mar 09, 2016</li><li><a href="./Getting-Started-with-Kotlin-and-Anko-on-Android.html">Getting Started with Kotlin and Anko on Android</a></li>
<li><a href="./RU-Дмитрий-Полищук-Kotlin-Android-практический-ликбез.html">(RU) Дмитрий Полищук - Kotlin + Android: практический ликбез</a></li>
<li class="pure-menu-list-date">Mar 08, 2016</li><li><a href="./A-DSL-Workbench-with-Gradle-and-Kotlin.html">A DSL Workbench with Gradle and Kotlin</a></li>
<li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-6.html">Kotlin & Android: A Brass Tacks Experiment, Part 6</a></li>
<li class="pure-menu-list-date">Mar 06, 2016</li><li><a href="./Solving-the-Josephus-problem-in-Kotlin.html">Solving the Josephus problem in Kotlin</a></li>
<li class="pure-menu-list-date">Mar 05, 2016</li><li><a href="./Kotlin-Month-Post-2-Inheritance-and-Defaults.html">Kotlin Month Post 2: Inheritance and Defaults</a></li>
<li class="pure-menu-list-date">Mar 04, 2016</li><li><a href="./Building-a-Kotlin-project-2-2.html">Building a Kotlin project 2/2</a></li>
<li><a href="./Building-a-Kotlin-project-1-2.html">Building a Kotlin project 1/2</a></li>
<li><a href="./RU-Видео-со-встречи-JUG-ru-с-разработчиками-Kotlin.html">(RU) Видео со встречи JUG.ru с разработчиками Kotlin</a></li>
<li class="pure-menu-list-date">Mar 03, 2016</li><li><a href="./Kotlin-a-new-JVM-language-you-should-try.html">Kotlin: a new JVM language you should try</a></li>
<li class="pure-menu-list-date">Mar 02, 2016</li><li><a href="./RU-Kotlin-для-начинающих.html">(RU) Kotlin для начинающих</a></li>
<li class="pure-menu-list-date">Mar 01, 2016</li><li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-5.html">Kotlin & Android: A Brass Tacks Experiment, Part 5</a></li>
<li><a href="./Developing-on-Android-sucks-a-lot-less-with-Kotlin.html">Developing on Android sucks a lot less with Kotlin</a></li>
<li class="pure-menu-list-date">Feb 29, 2016</li><li><a href="./The-Journey-of-a-Spring-Boot-application-from-Java-8-to-Kotlin-part-3-Data-Classes.html">The Journey of a Spring Boot application from Java 8 to Kotlin, part 3: Data Classes</a></li>
<li><a href="./Как-себе-выстрелить-в-ногу-в-Kotlin.html">Как себе выстрелить в ногу в Kotlin</a></li>
<li class="pure-menu-list-date">Feb 28, 2016</li><li><a href="./Kotlin-and-Ceylon.html">Kotlin and Ceylon</a></li>
<li class="pure-menu-list-date">Feb 27, 2016</li><li><a href="./Kotlin-Month-Post-1-Assorted-Features.html">Kotlin Month Post 1: Assorted Features</a></li>
<li class="pure-menu-list-date">Feb 24, 2016</li><li><a href="./Kotlin-2-Years-On.html">Kotlin - 2 Years On</a></li>
<li class="pure-menu-list-date">Feb 23, 2016</li><li><a href="./The-Journey-of-a-Spring-Boot-application-from-Java-8-to-Kotlin-part-2-Configuration-Classes.html">The Journey of a Spring Boot application from Java 8 to Kotlin, part 2: Configuration Classes</a></li>
<li><a href="./An-Introduction-to-Kotlin.html">An Introduction to Kotlin</a></li>
<li><a href="./Kotlin-1-0-is-finally-released.html">Kotlin 1.0 is finally released!</a></li>
<li class="pure-menu-list-date">Feb 22, 2016</li><li><a href="./More-Kotlin-Features-to-Love.html">More Kotlin Features to Love</a></li>
<li><a href="./A-Very-Peculiar-but-Possibly-Cunning-Kotlin-Language-Feature.html">A Very Peculiar, but Possibly Cunning Kotlin Language Feature.</a></li>
<li><a href="./Kotlin-Easily-storing-a-list-in-SharedPreferences-with-Custom-Accessors.html">Kotlin: Easily storing a list in SharedPreferences with Custom Accessors</a></li>
<li class="pure-menu-list-date">Feb 21, 2016</li><li><a href="./Kotlin — Love-at-first-line.html">Kotlin — Love at first line</a></li>
<li class="pure-menu-list-date">Feb 20, 2016</li><li><a href="./RU-Радио-Т-484.html">(RU) Радио-Т 484</a></li>
<li><a href="./RU-DevZen-Podcast-Kotlin-и-Vulkan-1-0-—-Episode-0080.html">(RU) DevZen Podcast: Kotlin и Vulkan 1.0 — Episode 0080.</a></li>
<li><a href="./The-Kobalt-diaries-testing.html">The Kobalt diaries: testing</a></li>
<li><a href="./RU-Немного-о-Kotlin.html">(RU) Немного о Kotlin.</a></li>
<li><a href="./Using-Mockito-for-unit-testing-with-Kotlin-1-x.html">Using Mockito for unit testing with Kotlin (1/x)</a></li>
<li><a href="./Weekend-resources-for-new-Kotlin-programmers.html">Weekend resources for new Kotlin programmers</a></li>
<li class="pure-menu-list-date">Feb 19, 2016</li><li><a href="./RU-Kotlin-1-0-Задай-вопрос-команде.html">(RU) Kotlin 1.0. Задай вопрос команде.</a></li>
<li class="pure-menu-list-date">Feb 16, 2016</li><li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-3.html">Kotlin & Android: A Brass Tacks Experiment, Part 3.</a></li>
<li><a href="./Kotlin-1-0-The-good-the-bad-and-the-evident.html">Kotlin 1.0: The good, the bad and the evident.</a></li>
<li><a href="./RU-Релиз-Kotlin-1-0-языка-программирования-для-JVM-и-Android.html">(RU) Релиз Kotlin 1.0, языка программирования для JVM и Android.</a></li>
<li class="pure-menu-list-date">Feb 15, 2016</li><li><a href="./JVM-Newcomer-Kotlin-1-0-is-GA.html">JVM Newcomer Kotlin 1.0 is GA</a></li>
<li><a href="./Developing-Spring-Boot-applications-with-Kotlin.html">Developing Spring Boot applications with Kotlin.</a></li>
<li><a href="./Kotlin-1-0-Released-Pragmatic-Language-for-JVM-and-Android.html">Kotlin 1.0 Released: Pragmatic Language for JVM and Android</a></li>
<li class="pure-menu-list-date">Feb 13, 2016</li><li><a href="./The-Journey-of-a-Spring-Boot-application-from-Java-8-to-Kotlin-The-Application-Class.html">The Journey of a Spring Boot application from Java 8 to Kotlin: The Application Class</a></li>
<li class="pure-menu-list-date">Feb 04, 2016</li><li><a href="./RU-Podcast-Разбор-Полетов-Episode-102-—-Kotlin-тесты-и-здоровый-сон.html">(RU) Podcast Разбор Полетов: Episode 102 — Kotlin, тесты и здоровый сон.</a></li>
<li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-4.html">Kotlin & Android: A Brass Tacks Experiment, Part 4</a></li>
<li><a href="./Kotlin-1-0-Release-Candidate-is-Out.html">Kotlin 1.0 Release Candidate is Out!</a></li>
<li class="pure-menu-list-date">Feb 03, 2016</li><li><a href="./Kotlin-Coding.html">Kotlin Coding</a></li>
<li class="pure-menu-list-date">Feb 02, 2016</li><li><a href="./10-Kotlin-Tutorials-for-Beginners-Dive-Into-Kotlin-Programming.html">10 Kotlin Tutorials for Beginners: Dive Into Kotlin Programming</a></li>
<li class="pure-menu-list-date">Feb 01, 2016</li><li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-2.html">Kotlin & Android: A Brass Tacks Experiment, Part 2.</a></li>
<li><a href="./Kotlin-Android-A-Brass-Tacks-Experiment-Part-1.html">Kotlin & Android: A Brass Tacks Experiment, Part 1.</a></li>
<li class="pure-menu-list-date">Jan 25, 2016</li><li><a href="./KillerTask-the-solution-to-AsyncTask-implementation.html">KillerTask, the solution to AsyncTask implementation</a></li>
<li class="pure-menu-list-date">Jan 23, 2016</li><li><a href="./My-Kotlin-Adventure.html">My Kotlin Adventure</a></li>
<li class="pure-menu-list-date">Jan 16, 2016</li><li><a href="./Mimicking-Kotlin-Builders-in-Java-and-Python.html">Mimicking Kotlin Builders in Java and Python</a></li>
<li class="pure-menu-list-date">Jan 15, 2016</li><li><a href="./Android-development-with-Kotlin.html">Android development with Kotlin</a></li>
<li><a href="./Kotlin-the-somewhat-obscure-modern-Android-friendly-programming-language.html">Kotlin, the somewhat obscure modern Android-friendly programming language</a></li>
<li class="pure-menu-list-date">Jan 14, 2016</li><li><a href="./Fun-with-Kotlin.html">Fun with Kotlin</a></li>
<li class="pure-menu-list-date">Jan 10, 2016</li><li><a href="./Playing-with-Spring-Boot-Vaadin-and-Kotlin.html">Playing with Spring Boot, Vaadin and Kotlin</a></li>
<li class="pure-menu-list-date">Jan 06, 2016</li><li><a href="./Kotlin-XML-Binding.html">Kotlin XML Binding</a></li>
<li class="pure-menu-list-date">Dec 30, 2015</li><li><a href="./Early-Impressions-of-Kotlin.html">Early Impressions of Kotlin</a></li>
<li class="pure-menu-list-date">Dec 12, 2015</li><li><a href="./Kotlin-for-Java-Developers-10-Features-You-Will-Love-About-Kotlin.html">Kotlin for Java Developers: 10 Features You Will Love About Kotlin</a></li>
<li class="pure-menu-list-date">Nov 11, 2015</li><li><a href="./Setting-up-Kotlin-with-Android-and-tests.html">Setting up Kotlin with Android and tests</a></li>
<li class="pure-menu-list-date">Nov 05, 2015</li><li><a href="./Functional-Programming-with-Kotlin.html">Functional Programming with Kotlin</a></li>
<li class="pure-menu-list-date">Oct 30, 2015</li><li><a href="./Exploring-the-Kotlin-standard-library.html">Exploring the Kotlin standard library</a></li>
<li class="pure-menu-list-date">Oct 22, 2015</li><li><a href="./Kotlin-NoSQL-for-MongoDB-in-Action.html">Kotlin NoSQL for MongoDB in Action</a></li>
<li class="pure-menu-list-date">Sep 21, 2015</li><li><a href="./Quasar-Efficient-and-Elegant-Fibers-Channels-and-Actors.html">Quasar: Efficient and Elegant Fibers, Channels and Actors</a></li>
<li class="pure-menu-list-date">Sep 18, 2015</li><li><a href="./Kotlin-❤-FP.html">Kotlin ❤ FP</a></li>
<li class="pure-menu-list-date">Aug 26, 2015</li><li><a href="./Production-Ready-Kotlin.html">Production Ready Kotlin</a></li>
<li class="pure-menu-list-date">Aug 12, 2015</li><li><a href="./JVMLS-2015-Flexible-Types-in-Kotlin.html">JVMLS 2015 - Flexible Types in Kotlin</a></li>
<li class="pure-menu-list-date">Aug 06, 2015</li><li><a href="./Building-APIs-on-the-JVM-Using-Kotlin-and-Spark-–-Part-1.html">Building APIs on the JVM Using Kotlin and Spark – Part 1</a></li>
<li class="pure-menu-list-date">Jul 31, 2015</li><li><a href="./RU-Без-слайдов-интервью-с-Дмитрием-Жемеровым-из-JetBrains.html">(RU) Без слайдов: интервью с Дмитрием Жемеровым из JetBrains</a></li>
<li class="pure-menu-list-date">Jul 20, 2015</li><li><a href="./Android-Kotlin-3.html">Android + Kotlin = <3</a></li>
<li class="pure-menu-list-date">Jul 06, 2015</li><li><a href="./Why-Kotlin-is-my-next-programming-language.html">Why Kotlin is my next programming language</a></li>
<li class="pure-menu-list-date">Jun 27, 2015</li><li><a href="./Exploring-Kotlin.html">Exploring Kotlin</a></li>
<li><a href="./RxAndroid-and-Kotlin-Part-1.html">RxAndroid and Kotlin (Part 1)</a></li>
<li class="pure-menu-list-date">Jun 04, 2015</li><li><a href="./Quasar-and-Kotlin-a-Powerful-Match.html">Quasar and Kotlin - a Powerful Match</a></li>
<li class="pure-menu-list-date">May 09, 2015</li><li><a href="./Kotlin-New-Hope-in-a-Java-6-Wasteland.html">Kotlin: New Hope in a Java 6 Wasteland</a></li>
<li class="pure-menu-list-date">Dec 11, 2014</li><li><a href="./Kotlin-for-Java-developers.html">Kotlin for Java developers</a></li>
<li class="pure-menu-list-date">Dec 01, 2014</li><li><a href="./Non-trivial-constructors-in-Kotlin.html">Non-trivial constructors in Kotlin</a></li>
<li class="pure-menu-list-date">Nov 03, 2014</li><li><a href="./GeeCON-Prague-2014-Andrey-Cheptsov-A-Reactive-and-Type-safe-Kotlin-DSL-for-NoSQL-and-SQL.html">GeeCON Prague 2014: Andrey Cheptsov - A Reactive and Type-safe Kotlin DSL for NoSQL and SQL</a></li>
<li class="pure-menu-list-date">Sep 10, 2014</li><li><a href="./Kotlin-vs-Java-puzzlers.html">Kotlin vs Java puzzlers</a></li>
<li class="pure-menu-list-date">Apr 02, 2013</li><li><a href="./The-Advent-of-Kotlin-A-Conversation-with-JetBrains-Andrey-Breslav.html">The Advent of Kotlin: A Conversation with JetBrains' Andrey Breslav</a></li>
<li class="pure-menu-list-date">Feb 07, 2013</li><li><a href="./Exploring-the-Kotlin-Standard-Library-Part-3.html">Exploring the Kotlin Standard Library - Part 3</a></li>
<li class="pure-menu-list-date">Jan 25, 2013</li><li><a href="./Exploring-the-Kotlin-Standard-Library-Part-2.html">Exploring the Kotlin Standard Library - Part 2</a></li>
<li class="pure-menu-list-date">Jan 23, 2013</li><li><a href="./The-Adventurous-Developer’s-Guide-to-JVM-languages-–-Kotlin.html">The Adventurous Developer’s Guide to JVM languages – Kotlin</a></li>
<li class="pure-menu-list-date">Jan 22, 2013</li><li><a href="./Exploring-the-Kotlin-Standard-Library-Part-1.html">Exploring the Kotlin Standard Library - Part 1</a></li>
      </ul>
    </div>
  </aside>

  <section id="main" class="main">
    <div class="main-content">
      <h1>
        <a href="http://allegro.tech/2016/06/kotlin-null-safety-part1.html">Kotlin null safety and its performance considerations -- part 1</a> - <span class="main-title-date">Jun 20, 2016</span>
      </h1>
      <h2>by Konrad Kamiński</h2>
      <p><a href="http://kotlinlang.org">Kotlin</a> may seem like a new kid on the block &ndash; it&#x2BC;s been officially released only in <a href="http://blog.jetbrains.com/kotlin/2016/02/kotlin-1-0-released-pragmatic-language-for-jvm-and-android/">February</a>. Its history however dates <a href="http://www.infoworld.com/article/2622405/java/jetbrains-readies-jvm-based-language.html">a few years back</a> and it&#x2BC;s mature and stable enough to be used for developing solid reliable applications. Therefore at <a href="http://allegro.pl">Allegro</a> we decided to give it a chance &ndash; we built our new shiny server-side system using Kotlin as its primary language and we do not regret it.</p>
<p>One of the first features a Kotlin developer learns is the language&#x2BC;s approach to handling <code>null</code> values. It is quite interesting &ndash; especially at times like these when the most popular way of handling this problem is to use some kind of <a href="https://en.wikipedia.org/wiki/Option_type">Option monad</a>. As we&#x2BC;ll soon see Kotlin actually does not introduce any new special wrapper type &ndash; it uses regular Java types albeit with slight variance.</p>
<h2>Null-safe world</h2>
<p>In Kotlin when you declare a variable, a field or a function parameter, by default they cannot be <code>null</code>. For example let&#x2BC;s suppose we have a class <code>Greeter</code> which has a function <code>hello</code> that by default prints a greeting message on the standard output:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Greeter</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">hello</span><span class="hljs-params">(who: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Unit</span> {
    println (<span class="hljs-string">"Hello <span class="hljs-subst">$who</span>"</span>)
  }
}</code></pre>
<p>We declared <code>who</code> to be of type <code>String</code> which is interpreted by the compiler to mean that <code>who</code> cannot be <code>null</code>. If we want to declare a <em>nullable</em> parameter we have to add a question mark at the end of the type name:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Greeter</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">hello</span><span class="hljs-params">(who: <span class="hljs-type">String</span>?)</span></span>: <span class="hljs-built_in">Unit</span> {
    println (<span class="hljs-string">"Hello <span class="hljs-subst">$who</span>"</span>)
  }
}</code></pre>
<p>This simple solution turns out to be very convenient and strong at the same time. It divides the world of our code into two areas: one where <code>null</code>s are allowed and one where they aren&#x2BC;t. As we&#x2BC;ll see in a moment Kotlin provides quite a range of helpful features which makes the transition between those areas entirely safe. Yet we have to be aware of a few surprising issues.</p>
<p>To fully explore how Kotlin handles <code>null</code>s underneath we&#x2BC;ll take a closer look at the code generated by Kotlin compiler. We&#x2BC;ll do it on two levels: first we&#x2BC;ll inspect the output bytecode &ndash; although for brevity we&#x2BC;ll actually see equivalent Java code. Then, in the second part of this article &ndash; for some interesting cases we&#x2BC;ll have a glance at the machine code generated by <a href="http://openjdk.java.net/groups/hotspot/docs/HotSpotGlossary.html#JITCompilers">JVM JIT compiler</a>.</p>
<h3>Smart casts</h3>
<p>Since Kotlin compiler knows the type of every variable, field, function parameter, etc. it can check if an incorrect assignment takes place and throw an error in such case. In the code below we try to assign a <em>nullable</em> reference to a <em>non-null</em> property:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> username: String = <span class="hljs-string">""</span>

  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setName</span><span class="hljs-params">(newName: <span class="hljs-type">String</span>?)</span></span> {
    username = newName <span class="hljs-comment">// the compiler will indicate an error here</span>
  }
}</code></pre>
<p>What if we wanted to check if the reference is not <code>null</code> and only then assign it to a property? The following code provides an answer:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> username: String = <span class="hljs-string">""</span>

  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setName</span><span class="hljs-params">(newName: <span class="hljs-type">String</span>?)</span></span> {
    <span class="hljs-keyword">if</span> (newName == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">throw</span> NullPointerException(<span class="hljs-string">"Name cannot be null!"</span>)

    username = newName <span class="hljs-comment">// here the compiler knows that newName cannot be null and therefore</span>
  }                    <span class="hljs-comment">// its type is String and not String?</span>
}</code></pre>
<p>This construct &ndash; where the compiler can infer that the reference cannot be <code>null</code> &ndash; is called smart casting as it seems to cast the reference from <code>String?</code> to <code>String</code>.</p>
<p>There is one thing we have to bear in mind when using smart casts. We can only do it with references that cannot be changed between the checkpoint and the actual assignment. In the code above the reference was taken from the function parameter which cannot change in the course of function execution. If we were to take the reference from some read/write property the compiler would not allow it:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserRequest</span> </span>{
  <span class="hljs-keyword">var</span> username: String? = <span class="hljs-literal">null</span>
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> username: String = <span class="hljs-string">""</span>

  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setNameFrom</span><span class="hljs-params">(request: <span class="hljs-type">UserRequest</span>)</span></span> {
    <span class="hljs-keyword">if</span> (request.username == <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">throw</span> NullPointerException(<span class="hljs-string">"Name cannot be null!"</span>)

    username = request.username <span class="hljs-comment">// here the compiler cannot be sure that request.username</span>
  }                             <span class="hljs-comment">// is not null - it could change in some other thread</span>
}                               <span class="hljs-comment">// right after the condition check</span></code></pre>
<h3>The !! operator</h3>
<p>The code shown in the above example looks quite common. When we expect a reference to be not <code>null</code> and this assumption proves wrong we may want to throw <code>NullPointerException</code>. Kotlin has a special syntax for such cases:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> username: String = <span class="hljs-string">""</span>

  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setName</span><span class="hljs-params">(newName: <span class="hljs-type">String</span>?)</span></span> {
    username = newName!! <span class="hljs-comment">// the type of newName!! is String and the compiler generates a runtime check to be sure of that...</span>
  }
}</code></pre>
<p>The equivalent Java code as taken from the bytecode generated by the Kotlin compiler is as follows:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">import</span> org.jetbrains.annotations.Nullable;

<span class="hljs-keyword">import</span> static kotlin.jvm.<span class="hljs-keyword">internal</span>.Intrinsics.throwNpe;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  <span class="hljs-keyword">private</span> String username = <span class="hljs-string">""</span>;

  <span class="hljs-keyword">public</span> void setName(<span class="hljs-meta">@Nullable</span> newName: String) {
    <span class="hljs-keyword">if</span> (newName == <span class="hljs-literal">null</span>) {
      throwNpe();
    }

    username = newName;
  }
}</code></pre>
<p>We can see a couple of interesting things here:</p>
<ol>
<li>The <code>newName</code> parameter of the <code>setName</code> method gets an annotation indicating its <em>nullability</em>. This annotation is used internally by Kotlin compiler and <a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a>, although one can think of using it also in tools like <a href="http://findbugs.sourceforge.net/">FindBugs</a> or <a href="http://types.cs.washington.edu/checker-framework/current/checker-framework-manual.html#nullness-checker">Checker Framework</a>.</li>
<li>The code in <code>setName</code> has a striking resemblance (surprise!) to the code we wrote in our smart cast example. The only difference is the usage of the <code>throwNpe</code> method. We&#x2BC;ll delve into the details in part 2 &ndash; for now we can make a simplification and state that it throws <code>KotlinNullPointerException</code> (which extends <code>NullPointerException</code>).</li>
</ol>
<h3>Parameter validation</h3>
<p>So far in our examples we didn&#x2BC;t have methods which were not private and at the same time had non-<code>null</code> parameters. In order to gain some insight into what happens in such situations let&#x2BC;s modify our code:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  <span class="hljs-keyword">var</span> username: String = <span class="hljs-string">""</span>

  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setName</span><span class="hljs-params">(newName: <span class="hljs-type">String</span>)</span></span> {
    username = newName
  }
}</code></pre>
<p>One obvious method that we&#x2BC;d like to have a look at is the <code>setName</code> method. But the equivalent Java code contains a surprise:</p>
<pre><code class="hljs language-java"><span class="hljs-keyword">import</span> org.jetbrains.annotations.NotNull;
<span class="hljs-keyword">import</span> org.jetbrains.annotations.Nullable;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> kotlin.jvm.internal.Intrinsics.checkParameterIsNotNull;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  <span class="hljs-meta">@NotNull</span>
  <span class="hljs-keyword">private</span> String username = <span class="hljs-string">""</span>;

  <span class="hljs-meta">@NotNull</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> username;
  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUsername</span><span class="hljs-params">(@NotNull String value)</span> </span>{
    checkParameterIsNotNull(value, <span class="hljs-string">"&lt;set-?&gt;"</span>);

    username = value;
  }

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(@NotNull String newName)</span> </span>{
    checkParameterIsNotNull(value, <span class="hljs-string">"newName"</span>);

    username = value;
  }
}</code></pre>
<p>We can see that we now have two additional methods (<code>getUsername</code> and <code>setUsername</code>) and the <code>username</code> field earned a <code>@NotNull</code> annotation. We&#x2BC;re witnesses to how Kotlin compiler manages properties in classes:</p>
<ol>
<li>If it is <code>private</code> then a property is simply a field of the class with no special annotations &ndash; this is because this property is not visible anywhere outside the class and therefore Kotlin compiler can optimize access to it and it can be sure that the field will always be non-<code>null</code>.</li>
<li>If it is not <code>private</code> then a property is actually a field with a pair of setter and getter methods &ndash; this is because the property is visible to the outside world and Kotlin compiler must check upon every access that it is non-<code>null</code> and at the same time provide this information to this outside world.</li>
</ol>
<p>We can also observe that to check whether a value of a parameter is not <code>null</code> the <code>checkParameterIsNotNull</code> method is used. Again we&#x2BC;ll investigate this method in part 2. For now it is enough to say that upon receiving a <code>null</code> value an <code>IllegalArgumentException</code> will be thrown.</p>
<h3>Elvis operator</h3>
<p>When we have a <code>null</code> value there are situations when instead of throwing an exception we&#x2BC;d rather do something else. We can compare this to a <code>default</code> block in Java <code>switch</code> statement. A simple <code>if</code> statement with an <code>else</code> should suffice here, but Kotlin has a special syntax for it &ndash; the famous <a href="https://en.wikipedia.org/wiki/Elvis_operator">Elvis operator</a>.</p>
<p>Let&#x2BC;s suppose that for a <code>null</code> value we&#x2BC;d like to set <code>username</code> to <code>&quot;N/A&quot;</code>:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> username: String = <span class="hljs-string">""</span>

  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setName</span><span class="hljs-params">(newName: <span class="hljs-type">String</span>?)</span></span> {
    username = newName ?: <span class="hljs-string">"N/A"</span>
  }
}</code></pre>
<p>The equivalent Java code is:</p>
<pre><code class="hljs language-java"><span class="hljs-keyword">import</span> org.jetbrains.annotations.Nullable;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  <span class="hljs-keyword">private</span> String username = <span class="hljs-string">""</span>;

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(@Nullable String newName)</span> </span>{
    username = (newName != <span class="hljs-keyword">null</span>) ? newName : <span class="hljs-string">"N/A"</span>;
  }
}</code></pre>
<p>The Kotlin syntax is more concise and it&#x2BC;s also worth mentioning that the expression after the Elvis operator is lazily evaluated and it can also throw an exception. So it&#x2BC;s completely legal to have this kind of code:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> username: String = <span class="hljs-string">""</span>

  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setName</span><span class="hljs-params">(newName: <span class="hljs-type">String</span>?)</span></span> {
    username = newName ?: <span class="hljs-keyword">throw</span> RuntimeException(<span class="hljs-string">"Are you nuts?"</span>)
  }
}</code></pre>
<p>The equivalent Java code is:</p>
<pre><code class="hljs language-java"><span class="hljs-keyword">import</span> org.jetbrains.annotations.Nullable;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  <span class="hljs-keyword">private</span> String username = <span class="hljs-string">""</span>;

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(@Nullable String newName)</span> </span>{
    <span class="hljs-keyword">if</span> (newName != <span class="hljs-keyword">null</span>)
      username = newName;
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Are you nuts?"</span>);
  }
}</code></pre>
<h3>Safe calls and let/run/apply functions</h3>
<p>There are circumstances when we have a possibly <code>null</code> object and we want to invoke a method on it but only if it is actually non-<code>null</code> (because otherwise we would get <code>NullPointerException</code>). We can do it with simple <code>if</code>, but Kotlin provides a fancy <code>?.</code> operator to make the code more compact. So this code:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">data</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SimpleUser</span></span>(<span class="hljs-keyword">var</span> name: String)

<span class="hljs-keyword">object</span> Users {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userMap = mapOf(<span class="hljs-number">1</span> to SimpleUser(<span class="hljs-string">"John"</span>))

  <span class="hljs-meta">@JvmStatic</span>
  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(userId: <span class="hljs-type">Int</span>)</span></span>: SimpleUser? = userMap[userId]
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUserName</span><span class="hljs-params">(userId: <span class="hljs-type">Int</span>)</span></span>: String? =
        getUser (userId)?.name</code></pre>
<p>has the following equivalent Java code for <code>getUserName</code>:</p>
<pre><code class="hljs language-java"><span class="hljs-meta">@Nullable</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUserName</span><span class="hljs-params">(<span class="hljs-keyword">int</span> userId)</span> </span>{
  SimpleUser simpleUser = getUser(userId);
  <span class="hljs-keyword">return</span> simpleUser != <span class="hljs-keyword">null</span> ? simpleUser.getName() : <span class="hljs-keyword">null</span>;
}</code></pre>
<p>Kotlin code is indeed a lot shorter and more expressive. To further aid developers Kotlin provides three convenient <a href="https://kotlinlang.org/docs/reference/lambdas.html#higher-order-functions">higher-order functions</a>: <code>let</code>, <code>run</code> and <code>apply</code>. Although they are not directly related to <code>null</code>-safety issues we often use them with potentially <code>null</code> objects. Below you can find some code examples &ndash; they should give you an intuition about when and how to use them.</p>
<h4>let</h4>
<p>Let&#x2BC;s look at the following code with <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/let.html"><code>let</code></a> (pardon the pun):</p>
<pre><code class="hljs language-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">findUserNameWithLet</span><span class="hljs-params">(userId: <span class="hljs-type">Int</span>)</span></span>: String? =
    getUser (userId)?.let { it.name }</code></pre>
<p><code>let</code> is essentially an <a href="https://kotlinlang.org/docs/reference/extensions.html#extension-functions">extension function</a> (i.e. a method of a class which you can define outside of the class definition) that can be invoked on any type. It takes a <a href="https://kotlinlang.org/docs/reference/lambdas.html#lambda-expressions-and-anonymous-functions">lambda expression</a> as its parameter and calls the expression with <code>this</code> as an argument. If a <em>lambda expression</em> has only one parameter then we may skip declaring it and simply access the parameter via the name... <code>it</code>. Therefore in the example above <code>this</code> inside the lambda (<code>this</code> is of type <code>SimpleUser</code> &ndash; the type returned by the <code>getUser</code> method) is accessible as <code>it</code>. The value of the <em>lambda expression</em> is returned as the result of the <code>let</code> function.</p>
<p>The equivalent Java code for <code>findUserNameWithLet</code> is as follows:</p>
<pre><code class="hljs language-java"><span class="hljs-meta">@Nullable</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">findUserNameWithLet</span><span class="hljs-params">(<span class="hljs-keyword">int</span> userId)</span> </span>{
  String result;

  SimpleUser simpleUser = getUser(userId);
  <span class="hljs-keyword">if</span> (simpleUser != <span class="hljs-keyword">null</span>) {
    SimpleUser it = simpleUser;

    result = it.getName(); <span class="hljs-comment">// { it.name }</span>
  } <span class="hljs-keyword">else</span> {
    result = <span class="hljs-keyword">null</span>;
  }

  <span class="hljs-keyword">return</span> result;
}</code></pre>
<p><code>let</code> is usually used if we want to perform some operations on a non-<code>null</code> object and return the result of these operations while simply returning <code>null</code> for <code>null</code> objects.</p>
<h4>run</h4>
<p>The <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/run.html"><code>run</code></a> function is a slight variation of <code>let</code>. It takes a parameterless <em>lambda expression</em> as its parameter and the object on which you invoke <code>run</code> can be accessed via <code>this</code> inside the <em>lambda expression</em>. Just like in <code>let</code> the result of the <em>lambda expression</em> is returned as the result of the <code>run</code> function.</p>
<p>Let&#x2BC;s see an example:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">findUserNameWithRun</span><span class="hljs-params">(userId: <span class="hljs-type">Int</span>)</span></span>: String? =
    getUser (userId)?.run { name }</code></pre>
<p>and the equivalent Java code:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-meta">@Nullable</span>
<span class="hljs-keyword">public</span> String findUserNameWithRun(int userId) {
  String result;

  SimpleUser simpleUser = getUser(userId);
  <span class="hljs-keyword">if</span> (simpleUser != <span class="hljs-literal">null</span>) {
    SimpleUser $receiver = simpleUser;

    result = $receiver.getName(); <span class="hljs-comment">// { name }</span>
  } <span class="hljs-keyword">else</span> {
    result = <span class="hljs-literal">null</span>;
  }

  <span class="hljs-keyword">return</span> result;
}</code></pre>
<p>As we can see there is little difference with <code>let</code> &ndash; Kotlin code is similar although with <code>run</code> it is even more concise.</p>
<h4>apply</h4>
<p>The last of the three convenient functions we&#x2BC;re going to talk about is <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/apply.html"><code>apply</code></a>. The following code illustrates its usage:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">findUserNameWithApply</span><span class="hljs-params">(userId: <span class="hljs-type">Int</span>)</span></span>: SimpleUser? =
      getUser (userId)?.apply { name = <span class="hljs-string">"Jane"</span> }
}</code></pre>
<p><code>apply</code> is similar to <code>run</code> &ndash; it is an <em>extension function</em> which takes a parameterless <em>lambda expression</em> as its parameter and the object on which you invoke <code>apply</code> can be accessed via <code>this</code> inside the <em>lambda expression</em>. However, the return value of <code>apply</code> is the object on which you invoke it (and not the <em>lambda expression</em> result).</p>
<p>The equivalent Java code for <code>findUserNameWithApply</code> is as follows:</p>
<pre><code class="hljs language-java"><span class="hljs-meta">@Nullable</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> SimpleUser <span class="hljs-title">findUserNameWithApply</span><span class="hljs-params">(<span class="hljs-keyword">int</span> userId)</span> </span>{
  SimpleUser result;

  SimpleUser simpleUser = getUser(userId);
  <span class="hljs-keyword">if</span> (simpleUser != <span class="hljs-keyword">null</span>) {
    SimpleUser $receiver = simpleUser;

    $receiver.setName(<span class="hljs-string">"Jane"</span>); <span class="hljs-comment">// { name = "Jane" }</span>

    result = simpleUser;
  } <span class="hljs-keyword">else</span> {
    result = <span class="hljs-keyword">null</span>;
  }

  <span class="hljs-keyword">return</span> result;
}</code></pre>
<p>The most common reason to use <code>apply</code> is the initialisation of an object. If there is something we have to do before returning an object (and simply return <code>null</code> if it is <code>null</code>) then <code>apply</code> is the way to go.</p>
<h3>Platform types</h3>
<p>So far we have not talked about the interoperability with Java. While from Java code point of view with regard to <code>null</code>-safety nothing unusual happens if we call Kotlin code, there is a difference when we want to call Java code from Kotlin. This is especially important for the case of the result returned from Java method where Kotlin compiler has to take some precautions. After all it does not know if the value returned can be <code>null</code> or not.</p>
<p>To resolve this problem Kotlin introduces the concept of <a href="https://kotlinlang.org/docs/reference/java-interop.html#null-safety-and-platform-types">platform types</a>. In essence <em>platform type</em> is used every time Kotlin compiler encounters an invocation of Java method which was not generated by Kotlin compiler. At the same time a developer cannot explicitly declare anything to be of <em>platform type</em> &ndash; it exists solely when Kotlin compiler infers it from the code.</p>
<p>Let&#x2BC;s look at some code samples which present most of things you have to know about <em>platform types</em>:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">writeOutNullable</span><span class="hljs-params">(s: <span class="hljs-type">String</span>?)</span></span> = println(s)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">nullableCase</span><span class="hljs-params">()</span></span> {
  <span class="hljs-keyword">val</span> value = System.getProperty(<span class="hljs-string">"key"</span>) <span class="hljs-comment">// value has a platform type String!</span>
  writeOutNullable(value)               <span class="hljs-comment">// The ! after a type indicates it's a platform type</span>
}</code></pre>
<p>The equivalent Java code is:</p>
<pre><code class="hljs language-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">nullableCase</span><span class="hljs-params">()</span> </span>{
  String value = System.getProperty(<span class="hljs-string">"key"</span>);
  writeOutNullable(value);
}</code></pre>
<p>We can see nothing special here &ndash; the <em>platform type</em> is taken as is when it is converted to a <em>nullable</em> type.</p>
<p>Let&#x2BC;s see what happens when the target type is non-<code>null</code>:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">writeOut</span><span class="hljs-params">(s: <span class="hljs-type">String</span>)</span></span> {
  println(s)
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">nonNullCase</span><span class="hljs-params">()</span></span> {
  <span class="hljs-keyword">val</span> value = System.getProperty(<span class="hljs-string">"key"</span>) <span class="hljs-comment">// value has a platform type String!</span>

  writeOut(value)
}</code></pre>
<p>The equivalent Java code is:</p>
<pre><code class="hljs language-java"><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> kotlin.jvm.internal.Intrinsics.checkExpressionValueIsNotNull;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">nonNullCase</span><span class="hljs-params">()</span> </span>{
  String value = System.getProperty(<span class="hljs-string">"key"</span>);

  checkExpressionValueIsNotNull(value, <span class="hljs-string">"value"</span>);
  writeOut(value);
}</code></pre>
<p>Now we have a validation in the generated code. <code>writeOut</code> expects a non-<code>null</code> type, but the <code>value</code> type is <em>platform type</em> and in theory it could be <code>null</code>. Therefore the compiler produces a runtime check with the help of <code>checkExpressionValueIsNotNull</code> method which we&#x2BC;ll explore in part 2.</p>
<p>Next example shows the code where only Java methods are used.</p>
<pre><code class="hljs language-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">pureJavaCase</span><span class="hljs-params">()</span></span> {
  <span class="hljs-keyword">val</span> value = System.getProperty(<span class="hljs-string">"key"</span>) <span class="hljs-comment">// value has a platform type String!</span>

  System.setProperty(<span class="hljs-string">"other_key"</span>, value)
}</code></pre>
<p>The equivalent Java code is:</p>
<pre><code class="hljs language-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">pureJavaCase</span><span class="hljs-params">()</span> </span>{
  String value = System.getProperty(<span class="hljs-string">"key"</span>);

  System.setProperty(<span class="hljs-string">"other_key"</span>, value);
}</code></pre>
<p>Just like when we had the <em>nullable</em> types no runtime check is generated. After all at no place in the code do we pass the value to the code which explicitly expects non-<code>null</code> values.</p>
<p>One might ask what happens after the value is checked not to be <code>null</code> &ndash; does the compiler treat it as a non-<code>null</code> value?</p>
<pre><code class="hljs language-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doubleCheckCase</span><span class="hljs-params">()</span></span> {
  <span class="hljs-keyword">val</span> value = System.getProperty(<span class="hljs-string">"key"</span>) <span class="hljs-comment">// value has a platform type String!</span>

  writeOut(value)
  writeOut(value)
}</code></pre>
<p>The equivalent Java code is:</p>
<pre><code class="hljs language-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doubleCheckCase</span><span class="hljs-params">()</span> </span>{
  String value = System.getProperty(<span class="hljs-string">"key"</span>);

  checkExpressionValueIsNotNull(value, <span class="hljs-string">"value"</span>);
  writeOut(value);
  checkExpressionValueIsNotNull(value, <span class="hljs-string">"value"</span>);
  writeOut(value);
}</code></pre>
<p>It appears it doesn&#x2BC;t &ndash; the runtime checks are generated each time the conversion to non-<code>null</code> type takes place.</p>
<p>The following example shows assigning the value with <em>platform type</em> to some variable without explicitly stating this variable type:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">assignCase</span><span class="hljs-params">()</span></span> {
  <span class="hljs-keyword">val</span> value = System.getProperty(<span class="hljs-string">"key"</span>) <span class="hljs-comment">// value has a platform type String!</span>
  <span class="hljs-keyword">val</span> newValue = value <span class="hljs-comment">// newValue has a platform type String!</span>

  writeOut(newValue)
}</code></pre>
<p>The equivalent Java code is:</p>
<pre><code class="hljs language-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">assignCase</span><span class="hljs-params">()</span> </span>{
  String value = System.getProperty(<span class="hljs-string">"key"</span>);
  String newValue = value;

  checkExpressionValueIsNotNull(newValue, <span class="hljs-string">"newValue"</span>);
  writeOut(newValue);
}</code></pre>
<p>No surprise here &ndash; the type of the variable <code>newValue</code> is also a <em>platform type</em> and runtime checks are generated.</p>
<p>What if we explicitly state the variable&#x2BC;s type?</p>
<pre><code class="hljs language-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">explicitCase</span><span class="hljs-params">()</span></span> {
  <span class="hljs-keyword">val</span> value = System.getProperty(<span class="hljs-string">"key"</span>) <span class="hljs-comment">// value has a platform type String!</span>

  <span class="hljs-keyword">val</span> nullableValue: String? = value
  writeOutNullable(nullableValue)

  <span class="hljs-keyword">val</span> nonNullValue: String = value
  writeOut(nonNullValue)
  writeOut(nonNullValue)
}</code></pre>
<p>The equivalent Java code is:</p>
<pre><code class="hljs language-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">explicitCase</span><span class="hljs-params">()</span> </span>{
  String value = System.getProperty(<span class="hljs-string">"key"</span>);

  String nullableValue = value;
  writeOutNullable(nullableValue);

  checkExpressionValueIsNotNull(value)
  String nonNullValue = value;
  writeOut(nonNullValue);
  writeOut(nonNullValue);
}</code></pre>
<p>As we can see the rule is simple &ndash; every time we go from the <em>plaform type</em> to non-<code>null</code> type a runtime check is generated. Once we&#x2BC;re in the <code>null</code>-safe world no additional validation is needed.</p>
<p>In the examples above we&#x2BC;ve seen that the <code>checkExpressionValueIsNotNull</code> method takes a variable name as the second parameter. This is done so that when a <code>null</code> value is passed you&#x2BC;ll see an error message with the name of the variable in it. But as the name of the method implies the second parameter does not have to be a variable name. In fact it&#x2BC;s always an expression name, but in the cases presented above we had simple one-variable expressions. If we had a more complicated expression...:</p>
<pre><code class="hljs language-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">funnyCase</span><span class="hljs-params">()</span></span> {
  writeOut(System.getProperty(<span class="hljs-string">"key"</span>))
}</code></pre>
<p>The equivalent Java code is:</p>
<pre><code class="hljs language-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">funnyCase</span><span class="hljs-params">()</span> </span>{
  String tmp = System.getProperty(<span class="hljs-string">"key"</span>);
  checkExpressionValueIsNotNull(tmp, <span class="hljs-string">"System.getProperty(\"key\")"</span>);
  writeOut(tmp);
}</code></pre>
<p>If we now call <code>funnyCase</code> (and there is no <code>&quot;key&quot;</code> system property set) then we&#x2BC;ll see the following stack trace:</p>
<pre><code>Exception in thread &quot;main&quot; java.lang.IllegalStateException: System.getProperty(&quot;key&quot;) must not be null
    at pl.kk.test.kotlin.PlatformTypesKt.funnyCase(PlatformTypes.kt:54)
    at pl.kk.test.kotlin.FunnyCaseCall.main(PlatformTypes.kt:60)
</code></pre>
<h3>Summary</h3>
<p>We&#x2BC;ve taken a tour of different Kotlin language constructs where you could observe the code generated by the compiler. During regular development you rarely have to think about how things work under the hood. Nonetheless it is useful to know a thing or two about it. And if you&#x2BC;re interested in the performance issues surrounding some of those constructs check out the second part of this article which will be soon published.</p>

      
      <div class="main-content-backlink">
        <hr/>
        <a href='http://kotlin.link/'>&larr; Back to kotlin.link</a>
      </div>
    </div>
  </section>

  <script>
    var menuLink = document.querySelector('.menu-link');

    var listener = function() {
      this.class = 'active';
      this.layout = document.getElementById('layout');
      this.handleEvent = function() {
        this.layout.classList.toggle(this.class);
      };
      this.handleEvent();
    };

    menuLink.addEventListener("click", function(){listener();}, false);
  </script>

  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/github.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
  <!-- Yandex.Metrika counter -->
  <script type="text/javascript">
    (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
        try {
          w.yaCounter35722810 = new Ya.Metrika({id:35722810,
            webvisor:true,
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true});
        } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
  </script>
  <noscript><div><img src="//mc.yandex.ru/watch/35722810" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
  <!-- /Yandex.Metrika counter -->
</body>
</html>
